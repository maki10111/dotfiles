#!/bin/sh


anime(){ \
	vidpath=$( find "$XDG_VIDEOS_DIR/anime" -type d | fzf ) || exit 1
#	setsid vlc --video-on-top "$vidpath" 2>/dev/null
	total=$(  find "$vidpath" -type f | wc -l )
#	episode=$(  echo "" | dmenu -i -p "From what episode of $total? ") || exit 1
	echo "From what episode?"; read -r num || exit
	[ -z "$num" ] && episode=1
	printf "Total : %s\nEpisode : %s\nStart : %s\n" "$total" "$num" "$((1+total-num))"
	episode=$(find "$vidpath" -type f | sort | sed "/$num/ q" | wc -l )
	start=$((1 + total - episode))

	# shellcheck disable=SC2046
	setsid mplayer -ao pulse,alsa,oss $(find "$vidpath" -type f | sort | tail -n "$start")


}


series(){
	vidpath=$( find "$XDG_VIDEOS_DIR/series" -type d | fzf ) || exit 1
#	setsid vlc --video-on-top "$vidpath" 2>/dev/null
	total=$( find "$vidpath" -type f | wc -l )

	echo "From what episode?"; read -r num || exit
	[ -z "$episode" ] && num=1
	episode=$(find "$vidpath" -type f | sort | sed "/$num/" q | wc -l )
	start=$((1 + total - episode))
	# shellcheck disable=SC2046
	setsid mplayer -ao pulse,alsa,oss $(find "$vidpath" -type f | sort | tail -n "$start")


}


movie(){
	file=$(find "$XDG_VIDEOS_DIR/movies" -type f |fzf ) || exit 1
	setsid vlc mplayer -on-top "$file" 2>/dev/null
}

copied(){
	item=$( find "$XDG_VIDEOS_DIR/copied" | fzf ) || exit 1
	setsid mplayer -ao pulse,alsa,oss "$item" 2>/dev/null

}
ytdl(){
	item=$( find "$XDG_VIDEOS_DIR/youtube-dl" -type f | fzf) || exit 1
	setsid mplayer -ao pulse,alsa,oss "$item" 2>/dev/null

}
choice=$(printf "Anime\\nSeries\\nMovie\\nCopied\\nDownloads" | fzf )

case "$choice" in
	Anime) anime;;
	Series) series;;
	Movie) movie;;
	Copied) copied;;
	Downloads) ytdl;;
	*) exit 1
esac
